<!DOCTYPE html><html>    <head>	<meta charset="UTF-8">        <meta name="viewport" content="width=device-width, initial-scale=1.0">        <meta name="author" content="Quentin SCHAU"/>        <link rel="stylesheet" href="./CSS/styles.css">    </head>	<body class='inscription'>		<?php			$serveur = "localhost";			$dbname = "mesappartements";			$user = "root";			$pass = "";			$nom = $_POST["nom"];			$prenom = $_POST["prenom"];			$Age = $_POST["Age"];			$genre = $_POST["genre"];			$ville = $_POST["ville"];			$code_postal = $_POST["code_postal"];			$email = $_POST["email"];			$numero_tel = $_POST["numero_tel"];			$password = $_POST["password"];			$nom_utilisateur = $_POST["nom_utilisateur"];                        $DateCrea = date('y-m-d H:i:s');                        $EtatCompte = "Actif";                        $Admin = $_POST['Admin'];						try{                            //On se connecte à la BDD                            $dbco = new PDO("mysql:host=$serveur;dbname=$dbname",$user,$pass);                            $dbco->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);                            //On vérifie que l'utilisateur n'existe pas                             $reponse = $dbco->prepare("SELECT COUNT(*) FROM users WHERE Nom = :nom and Prenom = :prenom and AdresseMail = :email");                            $reponse->bindParam(':nom',$nom);                            $reponse->bindParam(':prenom',$prenom);                            $reponse->bindParam(':email',$email);                            $reponse->execute();                            $compte = $reponse->fetch(PDO::FETCH_ASSOC)["COUNT(*)"];                            if ($compte>0){                                echo "<p>adresse mail déjà utilisée</br>";                                echo "<a href = \"inscription.html\"><input type=\"button\" value=\"retour\"></a></p>";                            }else{                            //Sinon on insère les données reçues                            $sth1 = $dbco->prepare("SELECT COUNT(*) FROM ville WHERE nom_reel = :ville AND CodePostal = :code_postal;");                            $sth1->bindParam(':ville',$ville);                            $sth1->bindParam(':code_postal',$code_postal);                            $sth1->execute();                            $compte2 = $sth1->fetch(PDO::FETCH_ASSOC)["COUNT(*)"];                            $sth1->CloseCursor();                            if ($compte2 >0){                                $sth2 = $dbco->prepare("SELECT IdVille FROM ville WHERE nom_reel = :ville AND CodePostal = :code_postal;");                                $sth2->bindParam(':ville',$ville);                                $sth2->bindParam(':code_postal',$code_postal);                                $sth2->execute();                                $res = $sth2->fetch(PDO::FETCH_ASSOC);                                $IdVille = $res['IdVille'];                                $sth = $dbco->prepare("                                        INSERT INTO users( Nom , Prenom , Age , Genre , AdresseMail , NumeroTel , nom_utilisateur , password , EtatCompte , Admin, DateCrea , IdVille )                                        VALUES( :nom , :prenom , :Age , :genre , :email , :numero_tel , :nom_utilisateur , :password , :EtatCompte , :Admin , :DateCrea, :IdVille )");                                $sth->bindParam(':nom',$nom);                                $sth->bindParam(':prenom',$prenom);                                $sth->bindParam(':Age',$Age);                                $sth->bindParam(':genre',$genre);                                $sth->bindParam(':email',$email);                                $sth->bindParam(':numero_tel',$numero_tel);                                $sth->bindParam(':nom_utilisateur',$nom_utilisateur);                                $sth->bindParam(':password',$password);                                $sth->bindParam(':EtatCompte',$EtatCompte );                                $sth->bindParam(':DateCrea',$DateCrea);                                $sth->bindParam(':Admin',$Admin);                                $sth->bindParam(':IdVille',$IdVille);                                $sth->execute();                                $sth->CloseCursor();                                $sth2->CloseCursor();                                header("Location:connexion.html");                            }                            else{                                echo "<p>Il y a une erreur de saisie sur le nom de la ville, verifie que celui-ci est correct</br>";                                echo "<a href = \"inscription.html\"><input type=\"button\" value=\"retour\"></a></p>";                            }                            //On renvoie l'utilisateur vers la page de connexion                            			}                    }                    catch(PDOException $e){                            echo 'Impossible de traiter les données. Erreur : '.$e->getMessage();                    }		?>	</body></html>